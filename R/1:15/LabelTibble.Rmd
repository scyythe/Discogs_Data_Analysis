---
title: "LabelTibble"
output: pdf_document
date: "2026-01-16"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(xml2)
```

Bringing in the xml file with all record labels info and converting it to a tidy tibble
Shout out https://r4ds.hadley.nz/rectangling.html
and https://xml2.r-lib.org/index.html
```{r}
#read in xml file
labelsxml <- read_xml("/Users/jakehinz/Documents/GitHub/Discogs_Data_Analysis/discogs_20260101_labels.xml")

#convert to list then tibble
labels_tidy_tibble <- labelsxml |> as_list() |> as_tibble() |> unnest_wider(labels) |>
  select(id, name, profile, parentLabel, contactinfo, data_quality) |>
  unnest_wider(id, names_sep = "_") |> unnest_wider(name, names_sep = "_") |> unnest_wider(contactinfo, names_sep = "_") |>
  unnest_wider(profile, names_sep = "_") |> unnest_wider(data_quality, names_sep = "_") |>
  unnest_wider(parentLabel, names_sep = "_")
```

Creating smaller dataset to test ideas on
```{r}
test_set <- labels_tidy_tibble |> head(1000)
```

Fixing column names, converting types
```{r}
#column names
labels_tidy_tibble <- labels_tidy_tibble |> rename("id" = "id_1", "name" = "name_1", "profile" = "profile_1", "parentLabel" = "parentLabel_1", "contactInfo" = "contactinfo_1", "dataQuality" = "data_quality_1")

#types
labels_tidy_tibble$dataQuality <- as_factor(labels_tidy_tibble$dataQuality)
labels_tidy_tibble <- labels_tidy_tibble %>% mutate(id = as.numeric(id))
```

Exploratory data analysis
```{r, fig.width=10, fig.height=4}
#dataQuality counts
ggplot(data = labels_tidy_tibble, mapping = aes(x = dataQuality)) +
  geom_bar()

#subLabel counts
labels_tidy_tibble <- labels_tidy_tibble %>% mutate(subLabel = is.na(parentLabel) == FALSE)
ggplot(data = labels_tidy_tibble, mapping = aes(x = subLabel)) +
  geom_bar()

#log(profileLength) ~ dataQuality
labels_tidy_tibble <- labels_tidy_tibble %>% mutate(profileLength = str_length(profile))
labels_tidy_tibble <- labels_tidy_tibble %>% mutate(profileLength = ifelse(is.na(profile), 0, profileLength))
ggplot(data = labels_tidy_tibble, mapping = aes(x = dataQuality, y = log(profileLength+1))) +
  geom_boxplot()

#longest profile length
labels_tidy_tibble %>% filter(profileLength == 23183)

#
labels_tidy_tibble %>% ggplot(mapping = aes(x = log(profileLength+1), y = subLabel)) +
  geom_boxplot()
```










Getting a snippet of masters release data to look at data structure
```{zsh}
head -n 3000 /Users/jakehinz/Documents/GitHub/Discogs_Data_Analysis/discogs_20260101_masters.xml
brew install libxml2
```
```{zsh}
xmllint --format /Users/jakehinz/Documents/GitHub/Discogs_Data_Analysis/snippet.xml
```



Iterating over xml
Shout out https://www.trivialproblems.com/posts/incremental-xml-parsing-with-python/
```{python}
import xml.etree.ElementTree as ET

iter = ET.iterparse("/Users/jakehinz/Documents/GitHub/Discogs_Data_Analysis/discogs_20260101_masters.xml", events=["start", "end"])
```







